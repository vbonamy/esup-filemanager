<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Performance / Java</title>

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/webjars/bootstrap-icons/font/bootstrap-icons.min.css}" />
    <link rel="stylesheet" th:href="@{/css/esup-stock.css}" type="text/css" media="screen, projection">
</head>
<body>
<div>
    <h2>Performance / Java</h2>

    <div>
        <h3>Memory</h3>
        <ul class="list">
            <li><span>max Memory :</span> <span th:text="${maxMemoryInMB}"></span> MB</li>
            <li><span>total Memory :</span> <span th:text="${totalMemoryInMB}"></span> MB</li>
            <li><span>free Memory :</span> <span th:text="${freeMemoryInMB}"></span> MB</li>
            <li><span>used Memory :</span> <span th:text="${usedMemoryInMB}"></span> MB</li>
        </ul>
    </div>
    <div>
        <h3>Threads</h3>
        <ul class="list">
            <li>
                <span>threads en cours</span>
                <ul>
                    <li th:each="threadState : ${threadStateCount}"
                        th:classappend="${threadState.key == 'RUNNABLE'} ? 'alert-warning' : (${threadState.key == 'BLOCKED'} ? 'alert-danger' : '')"
                        th:text="${threadState.key} + ' : ' + ${threadState.value}"></li>
                </ul>
            </li>
            <li><span>avec un pic de</span> <span th:text="${javaPerfWrapper.peakThreadCount}"></span> <span>threads</span></li>
            <li><span>(num. thread courant :</span> <span th:text="${currentThreadId}"></span>)</li>
        </ul>

        <table class="table table-striped">
            <tr>
                <th>Thread Id</th>
                <th>Thread Name</th>
                <th>Thread State</th>
                <th>Blocked Count</th>
                <th>Blocked Time</th>
                <th>Waited Count</th>
                <th>Waited Time</th>
                <th>Stack Trace</th>
            </tr>

            <tr th:each="threadInfo : ${javaPerfWrapper.threadInfoWrappers}"
                th:classappend="${currentThreadId eq threadInfo.threadId ? 'success' : (threadInfo.threadState eq 'RUNNABLE' ? 'warning' : (threadInfo.threadState eq 'BLOCKED' ? 'danger' : ''))}">
                <td th:text="${threadInfo.threadId}"></td>
                <td th:text="${threadInfo.threadName}"></td>
                <td th:text="${threadInfo.threadState}"></td>
                <td th:text="${threadInfo.blockedCount}"></td>
                <td th:text="${threadInfo.blockedTime}"></td>
                <td th:text="${threadInfo.waitedCount}"></td>
                <td th:text="${threadInfo.waitedTime}"></td>
                <td>
                    <span th:each="stackTrace : ${threadInfo.stackTrace}">
                        <span th:text="${stackTrace.className} + '.' + ${stackTrace.methodName} + '(' + ${stackTrace.fileName} + ':' + ${stackTrace.lineNumber} + ')'"></span><br/>
                    </span>
                </td>
            </tr>
        </table>
    </div>
</div>
</body>
</html>